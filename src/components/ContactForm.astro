---
import '../styles/ContactForm.css';
---

<section id="contacto" class="contact-section">
	<div class="container">
		<div class="contact-header">
			<h2>¿Necesitas Nuestros Servicios?</h2>
			<p class="contact-description">Contáctanos para solicitar una cotización o más información sobre nuestros servicios profesionales</p>
		</div>
		
		<div class="form-container">
		<h3>Formulario de Contacto</h3>
		
		<div id="success-message" class="success-message">
			<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
				<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
				<polyline points="22 4 12 14.01 9 11.01"></polyline>
			</svg>
			<h3>¡Mensaje enviado con éxito!</h3>
			<p>Gracias por contactarnos. Te responderemos pronto.</p>
			<button type="button" class="back-button" onclick="location.reload()">Enviar otro mensaje</button>
		</div>

		<form id="contact-form" action="/api/contact" method="POST">
			<div class="form-group">
				<label for="name">Nombre:</label>
				<input type="text" id="name" name="name" required placeholder="Tu nombre completo">
			</div>

			<div class="form-group">
				<label for="email">Email:</label>
				<input type="email" id="email" name="email" required placeholder="tu@email.com">
			</div>

			<div class="form-group">
				<label for="message">Mensaje:</label>
				<textarea id="message" name="message" required placeholder="Escribe tu mensaje aquí..." rows="5"></textarea>
			</div>

			<!-- Honeypot Spam Protection -->
			<input type="checkbox" name="botcheck" class="hidden" style="display: none;">

			<button type="submit" class="submit-button">
				<span class="button-text">Enviar Formulario</span>
				<span class="button-loading">Enviando...</span>
			</button>
		</form>
		</div>
	</div>
</section>

<script>
	const form = document.getElementById('contact-form') as HTMLFormElement;
	const successMessage = document.getElementById('success-message') as HTMLElement;
	const submitButton = form.querySelector('.submit-button') as HTMLButtonElement;

	form.addEventListener('submit', async (e) => {
		e.preventDefault();
		
		submitButton.classList.add('loading');
		submitButton.disabled = true;

		const formData = new FormData(form);

		try {
			const response = await fetch('/api/contact', {
				method: 'POST',
				body: formData
			});

			const data = await response.json();

			if (data.success) {
				form.style.display = 'none';
				successMessage.style.display = 'block';
			} else {
				alert('Error al enviar el formulario. Por favor, intenta de nuevo.');
				submitButton.classList.remove('loading');
				submitButton.disabled = false;
			}
		} catch (error) {
			alert('Error al enviar el formulario. Por favor, intenta de nuevo.');
			submitButton.classList.remove('loading');
			submitButton.disabled = false;
		}
	});
</script>
